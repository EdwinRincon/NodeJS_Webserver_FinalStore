(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"+p+5":function(t,e,n){"use strict";n.r(e),n.d(e,"OrderModule",(function(){return B}));var c=n("ofXK"),i=n("tyNb"),o=n("PSD3"),a=n.n(o),r=n("fXoL"),s=n("NPRe"),p=n("xHqg"),d=n("bTqV"),l=n("NFeN");let u=(()=>{class t{constructor(){this.groupedProducts=[]}transform(t){for(const e of t)if(0===this.groupedProducts.length)this.groupedProducts.push(Object.assign(e,{quantity:1}));else if(this.groupedProducts.find(this.p=t=>t.name===e.name)){const t=this.groupedProducts.findIndex(this.p);this.groupedProducts[t].quantity+=1}else this.groupedProducts.push(Object.assign(e,{quantity:1}));return this.groupedProducts}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=r.Ob({name:"cartRepeat",type:t,pure:!0}),t})();const b=["paypal-button-container"],f=["upButton"];function m(t,e){1&t&&r.zc(0,"Sus productos")}function h(t,e){1&t&&(r.Vb(0,"p"),r.zc(1,"no hay productos"),r.Ub())}function g(t,e){if(1&t&&(r.Vb(0,"div",11),r.Vb(1,"div",12),r.Qb(2,"img",13),r.Ub(),r.Ub()),2&t){const t=r.fc().$implicit;r.Db(2),r.lc("src",t.img,r.tc)}}function y(t,e){if(1&t&&(r.Vb(0,"div",14),r.Vb(1,"div",12),r.zc(2),r.Ub(),r.Ub()),2&t){const t=r.fc().$implicit;r.Db(2),r.Bc(" ",t.name," ")}}function v(t,e){if(1&t&&(r.Vb(0,"div",15),r.Vb(1,"div",12),r.zc(2),r.gc(3,"currency"),r.Ub(),r.Ub()),2&t){const t=r.fc().$implicit;r.Db(2),r.Bc(" ",r.hc(3,1,t.price)," ")}}function w(t,e){if(1&t&&(r.Vb(0,"div",15),r.Vb(1,"div",12),r.zc(2),r.Ub(),r.Ub()),2&t){const t=r.fc().$implicit;r.Db(2),r.Bc(" Cantidad: ",t.quantity," ")}}function x(t,e){if(1&t){const t=r.Wb();r.Vb(0,"div",16),r.Vb(1,"div",12),r.Vb(2,"button",17),r.dc("click",(function(){r.sc(t);const e=r.fc().$implicit;return r.fc(2).deleteProduct(e)})),r.zc(3,"-"),r.Ub(),r.Ub(),r.Ub()}}function _(t,e){if(1&t&&(r.Vb(0,"div",6),r.yc(1,g,3,1,"div",7),r.yc(2,y,3,1,"div",8),r.yc(3,v,4,3,"div",9),r.yc(4,w,3,1,"div",9),r.yc(5,x,4,0,"div",10),r.Ub()),2&t){const t=e.$implicit;r.Db(1),r.lc("ngIf",t.quantity>0),r.Db(1),r.lc("ngIf",t.quantity>0),r.Db(1),r.lc("ngIf",t.quantity>0),r.Db(1),r.lc("ngIf",t.quantity>0),r.Db(1),r.lc("ngIf",t.quantity>0)}}function P(t,e){if(1&t&&(r.Vb(0,"div"),r.yc(1,h,2,0,"p",1),r.yc(2,_,6,5,"div",5),r.Ub()),2&t){const t=e.ngIf;r.Db(1),r.lc("ngIf",0===t.length),r.Db(1),r.lc("ngForOf",t)}}function I(t,e){if(1&t&&(r.Vb(0,"h1"),r.zc(1),r.gc(2,"currency"),r.Ub()),2&t){const t=r.fc(2);r.Db(1),r.Bc("Total a Pagar: ",r.hc(2,1,t.totalAPagar)," ")}}function O(t,e){if(1&t&&(r.Vb(0,"div"),r.yc(1,I,3,3,"h1",1),r.Ub()),2&t){const t=e.ngIf;r.Db(1),r.lc("ngIf",t.length>0)}}function V(t,e){1&t&&r.zc(0,"Pago")}function U(t,e){if(1&t){const t=r.Wb();r.Vb(0,"button",19),r.dc("click",(function(){return r.sc(t),r.fc(2).toTop()})),r.Vb(1,"mat-icon"),r.zc(2,"expand_less"),r.Ub(),r.Ub()}}function C(t,e){if(1&t&&(r.Vb(0,"div"),r.yc(1,U,3,0,"button",18),r.Ub()),2&t){const t=e.ngIf;r.Db(1),r.lc("ngIf",t.length>0)}}const D=[{path:"",component:(()=>{class t{constructor(t){this.cartService=t,this.arrayFinal=[],this.products$=this.cartService.cart$,this.totalAPagar=this.cartService.totalAPagar}ngAfterViewInit(){localStorage.clear();let t,e=this.totalAPagar;document.getElementById("capsula").addEventListener("mouseenter",()=>{this.products$.subscribe(e=>{this.arrayFinal=e,this.arrayFinal=this.CartRepeatDelete(this.arrayFinal),localStorage.setItem("ordersproducto",JSON.stringify(this.arrayFinal)),t=JSON.parse(localStorage.getItem("ordersproducto"))}),e=this.totalAPagar}),paypal.Buttons({style:{color:"blue"},createOrder:(t,n)=>n.order.create({purchase_units:[{amount:{value:e}}]}),onApprove:async(e,n)=>{n.order.capture().then(async e=>fetch("https://api-final-store.herokuapp.com/webapi/clientes",{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({payer_id:e.payer.payer_id,given_name:e.payer.name.given_name,surname:e.payer.name.surname,email_address:e.payer.email_address,address_line:e.purchase_units[0].shipping.address.address_line_1,postal_code:e.purchase_units[0].shipping.address.postal_code,city:e.purchase_units[0].shipping.address.admin_area_1})}).then(n=>{if(n.ok){let n;return n=e.purchase_units[0].payments.captures[0].create_time,fetch("https://api-final-store.herokuapp.com/webapi/orders",{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({id_order:e.id,payer_id:e.payer.payer_id,create_time:n.slice(0,10)})}).then(async n=>{if(n.ok){a.a.fire({title:"Compra Recibida!",html:"Deseamos volver a verte! "+e.payer.name.given_name+"<br></br>Guarda tu codigo de orden<br></br>"+e.id,icon:"success",confirmButtonText:"Aceptar"});for(let n=0;n<t.length;n++)await fetch("https://api-final-store.herokuapp.com/webapi/ordersproducto",{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({id_order:e.id,payer_id:e.payer.payer_id,cantidad:t[n].quantity})})}}).catch(t=>{a.a.fire({title:"Error!",html:"<br></br>Ha habido un problema,<br></br>ponte en Contacto para terminar tu compra<br></br>recuerda que hemos recibido ya tu pago.",icon:"error",confirmButtonText:"Aceptar"})})}a.a.fire({title:"Error!",html:"backend status: "+n.status,icon:"error",confirmButtonText:"Aceptar"})})),localStorage.clear()},onError:t=>{localStorage.clear(),a.a.fire({title:"Oops!",text:"Lo sentimos ha habido un error, Intentalo mas tarde",icon:"warning",confirmButtonText:"Aceptar"})}}).render("#paypal-button-container")}addProduct(t){this.cartService.addCart(t)}async deleteProduct(t){this.totalAPagar=await this.cartService.deleteCart(t)}toTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}CartRepeatDelete(t){const e=[];let n;for(const c of t)if(0===e.length)e.push(Object.assign(c,{quantity:1}));else if(e.find(n=t=>t.name===c.name)){const t=e.findIndex(n);e[t].quantity+=1}else e.push(Object.assign(c,{quantity:1}));return e}}return t.\u0275fac=function(e){return new(e||t)(r.Pb(s.a))},t.\u0275cmp=r.Jb({type:t,selectors:[["app-order"]],viewQuery:function(t,e){var n;1&t&&(r.wc(b,!0),r.wc(f,!0)),2&t&&(r.pc(n=r.ec())&&(e.paypalElement=n.first),r.pc(n=r.ec())&&(e.upButton=n.first))},decls:14,vars:12,consts:[["matStepLabel",""],[4,"ngIf"],[3,"stepControl"],["id","capsula"],["id","paypal-button-container"],["class","row",4,"ngFor","ngForOf"],[1,"row"],["class","clearfix col-xs-1 col-sm-3 col-md-2",4,"ngIf"],["class","clearfix col-xs-12 col-sm-4 col-md-3",4,"ngIf"],["class","col-xs-12 col-sm-2 col-md-2",4,"ngIf"],["class","col-xs-12 col-sm-1 col-md-2",4,"ngIf"],[1,"clearfix","col-xs-1","col-sm-3","col-md-2"],[1,"box"],["alt","producto",1,"image",3,"src"],[1,"clearfix","col-xs-12","col-sm-4","col-md-3"],[1,"col-xs-12","col-sm-2","col-md-2"],[1,"col-xs-12","col-sm-1","col-md-2"],["mat-raised-button","","color","warn",3,"click"],["id","upButton","mat-mini-fab","","color","warn","aria-label","up",3,"click",4,"ngIf"],["id","upButton","mat-mini-fab","","color","warn","aria-label","up",3,"click"]],template:function(t,e){1&t&&(r.Vb(0,"mat-horizontal-stepper"),r.Vb(1,"mat-step"),r.yc(2,m,1,0,"ng-template",0),r.yc(3,P,3,2,"div",1),r.gc(4,"cartRepeat"),r.gc(5,"async"),r.yc(6,O,2,1,"div",1),r.gc(7,"async"),r.Ub(),r.Vb(8,"mat-step",2),r.yc(9,V,1,0,"ng-template",0),r.Vb(10,"div",3),r.Qb(11,"div",4),r.Ub(),r.Ub(),r.Ub(),r.yc(12,C,2,1,"div",1),r.gc(13,"async")),2&t&&(r.Db(3),r.lc("ngIf",r.hc(4,4,r.hc(5,6,e.products$))),r.Db(3),r.lc("ngIf",r.hc(7,8,e.products$)),r.Db(2),r.lc("stepControl",!1),r.Db(4),r.lc("ngIf",r.hc(13,10,e.products$)))},directives:[p.a,p.b,p.c,c.l,c.k,d.b,l.a],pipes:[u,c.b,c.d],styles:[".image[_ngcontent-%COMP%]{max-width:100%}#capsula[_ngcontent-%COMP%]{width:-webkit-min-content;width:-moz-min-content;width:min-content}button.accept[_ngcontent-%COMP%]{height:35px}@media screen and (max-width:400px){button.accept[_ngcontent-%COMP%]{width:200px}#paypal-button-container[_ngcontent-%COMP%]{width:100%}}@media screen and (min-width:400px){#paypal-button-container[_ngcontent-%COMP%], button.accept[_ngcontent-%COMP%]{width:250px}}#upButton[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:30px;z-index:99;cursor:pointer;opacity:.6;-webkit-transition:.3s;transition:.3s}#upButton[_ngcontent-%COMP%]:hover{opacity:1}h1[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center}@media (max-width:768px){.image[_ngcontent-%COMP%]{min-width:140px;max-width:30%}}"]}),t})()}];let k=(()=>{class t{}return t.\u0275mod=r.Nb({type:t}),t.\u0275inj=r.Mb({factory:function(e){return new(e||t)},imports:[[i.h.forChild(D)],i.h]}),t})();var S=n("hctd"),q=n("PCNd");let B=(()=>{class t{}return t.\u0275mod=r.Nb({type:t}),t.\u0275inj=r.Mb({factory:function(e){return new(e||t)},imports:[[c.c,k,S.a,q.a]]}),t})()}}]);